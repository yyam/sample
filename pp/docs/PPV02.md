Programming Practices Volume #2
===============================
revision: 0.1 (2013.5.7)

[基本ルール](../README.md)

### Questions

* [Q201] 全角半角変換				(10行/30分)
* [Q202] 組み合わせ				(20行/30分)
* [Q203] ハッシュ操作				(20行/30分)
* [Q204] 配列操作				(20行/30分)
* [Q205] SALTED HASH			(30行/45分)
* [Q206] ファイルとハッシュの操作	(30行/45分)

想定実施合計: 3時間30分

[Q201]全角半角変換
---------------
与えられた文字列中に、全角のアルファベット、数字、スペースが含まれていたら、全て半角に変換する処理を作成して下さい。

例）

	Ｔｈｉｓ　ｉｓ　全角. 		# 全角アルファベット、スペースを含んでいる.
	…変換…
	This is 全角.			# 半角に変換する.
	
本問題は、プログラムを実行している環境で用いている文字コードによって、対応方法が異なるかもしれません。また、関連ライブラリーが国際化未対応なため、エラーをなくすことはできないかもしれません。テストプログラムは、UTF8環境を前提としていますが、異なる環境では正常に動作しないかもしれません。その場合は、正常動作するか否かも含め、必要な対応をプログラムのコメントとして記述して下さい。

多くの場合、アスキー文字以外の文字コードをプログラム内に記述するのは、国際化に関する問題が生じる可能性がありますが、本問題では可とします。

###subroutine

	Vol02::full2half
	
###test program

	t/full2half.t

###条件
* 引数: 文字列。
* 戻り値: 全角アルファベットおよび数字、スペースを半角に変換したものを戻す。引数が指定されなかったときは0を戻す。

###想定工数
10行程度 / 30分


[Q202] 組み合わせ
---------------
半角の文字列列が指定されたら、全ての大文字小文字の組み合わせを、アルファベット順（小文字がより先に来る）にソートした配列のリファレンスとして返す処理を作成して下さい。

HelloWorldの例）

	  helloworld, helloworlD, helloworLd, helloworLD, hellowoRld,
	  hellowoRlD, hellowoRLd, hellowoRLD, hellowOrld, hellowOrlD,
	  …
	  HELLOWoRLD, HELLOWOrld, HELLOWOrlD, HELLOWOrLd, HELLOWOrLD, 
	  HELLOWORld, HELLOWORlD, HELLOWORLd, HELLOWORLD

	…2^10(文字数) = 1024の組み合わせがある

###subroutine

	Vol02::pattern

###条件
* 引数: 文字列。
* 戻り値: 文字列の大文字小文字すべての組み合わせを含む配列のリファレンス。小文字がより先に来るようにソートされていること。引数に文字列が指定されなかったときは0を返す。

###test program

	t/pattern.t

###ヒント
* ある範囲の数値を２進数で表すと、0と1の組み合わせのパターンを作ることができます。例えば16までの2新表現は、0000, 0001, 0010, 0011, 0100, 0101, 0110, 0111, 1000 ... と続きます。
* sprintf("%b", $n) で、$nの2進数表現を得ることができます。0で4桁分を埋めたければ、sprintf("%04b", $n) とします。
* ある文字列$sの$n番目の文字一文字を取り出すには、substr($s, $n, 1)で取り出せます。

###想定工数
20行程度 / 30分



[Q206] ハッシュ操作
------------------
以下に２つのハッシュのリファレンスがあります。

lib/Conf/Questions.pm

	package Conf::Questions;
	
	our $QUESTIONS = +{
	    'Q004' => +{
	        description => '2 digits multiplication',
	        questions => [
	            [ 1, 37], [48, 61], [99, 67], [87, 12], [69, 68],
	            [12, 11], [21, 32], [38, 80], [51, 98], [20, 47] 
	        ]
	    },
	    'Q005' => +{
	        description => '2 digits multiplication',
	        questions => [
	            [15, 30], [28, 12], [51, 83], [77, 17], [99, 17],
	            [37, 61], [11, 31], [39, 40], [41, 88], [70, 56] 
	        ]
	    }
	};

lib/conf/Studnets.pm

	package Conf::Students;
	
	our $STUDENTS = +{
	    'Aoki Masashi' => {
	        'Q004' => [101, 522, 995, 994, 200, 351, 41,  77,  55, 420],
	        'Q005' => [45, 336, 4233, 1309, 1683, 2257, 341, 1560, 3608, 3920],
	    },
	
	    'Suzuki Jiro' => +{
	        'Q004' => [102, 522, 995, 994, 200, 351, 47,  77,  55, 420],
	        'Q005' => [450, 336, 4223, 1309, 1683, 2258, 341, 1561, 3608, 3920],
	    },
	
	    'Okada Keiko' => +{
	        'Q004' => [101, 522, 995, 994, 200, 351, 41,  77,  55, 420],
	        'Q005' => [450, 336, 4233, 1309, 1683, 2257, 341, 1560, 3608, 3920],
	    },
	
	    'Yamada Yoshio' => +{
	        'Q004' => [151, 522, 995, 994, 200, 351, 40,  77,  55, 420],
	        'Q005' => [450, 335, 4233, 1309, 1683, 2257, 341, 1560, 3608, 3220],
	    },
	};

$QUESTIONSには問題のデータが含まれており、$STUDENTSにはそれに対する生徒の解答が含まれています。QUESTIONS内の'questions'内の配列に含まれる２つの数字をかけた数を、生徒が回答した情報がSTUDENTSの配列内に含まれています。

'Q005'の問題に関して、それぞれの生徒の解答が正しいかを採点し、各生徒の正解数を含むハッシュのリファレンスを返す、処理を作成して下さい。

期待するハッシュ・リファレンス）

	+{ 'Suzuki Jiro'   => +{ 'Q005' => 7  },
       'Okada Keiko'   => +{ 'Q005' => 10 },
       'Aoki Masashi'  => +{ 'Q005' => 9  },
       'Yamada Yoshio' => +{ 'Q005' => 8  }
    };

###subroutine

	Vol02::mark

###test program

	t/mark.t

###想定工数
20行程度 / 30分



[Q203] 配列操作
---------------
配列のリファレンスを渡すと、配列内の値がランダムに並び替えられた、新しい配列を作りそのリファレンスを返す処理を作成して下さい。

###subroutine

	Vol02::arrayShuffle
	
###条件
* 引数: 並び替えたい配列のリファレンスを指定する。	
* 戻り値: 順序が並び替えられた配列のリファレンスを返す。元の配列は変更せず、新たに配列を作成し、それを返す。引数が渡されなかったとき時や、配列のリファレンス以外が渡されたときは0を返す。

####使用例)
	my $fluit = ["apple", "banana", "cherry"];
	my $shuffled = Vol2::arrayShuffle($fluit); 
	print "@{$shuffled}";       # banana cherry apple … shuffled

###test program

	t/arrayShuffle.t

###想定工数
20行程度 / 30分



[Q204] SALTED HASH
---------------
ある文字列からSHA1によるハッシュ値を生成すると、同一の文字から同一のハッシュ値が生成されます。よって、生成されたハッシュ値と元の文字列の対応を知っていれば、ハッシュ値をキーにして元の文字列を探すことが可能です。

secretという文字例のSHA1 HEX値）

	secret = e5e9fa1ba31ecd1ae84f75caaa474f3a663f05f4

上記の文字列と"secret"という文字列は一対一で対応するため、経験的蓄積による辞書を作っておけば、比較的簡単に元の文字列が得られます。

各種ハッシュ値と文字の対応を公開しているサイトの例)  
[http://www.md5-hash.com](http://www.md5-hash.com)

ハッシュ値をそのまま使用するのではなく、次の生成方法により、ハッシュ生成時にランダムな16進数２桁の文字(salt)を、元の文字列の先頭に追加し、その文字列を元に生成されたハッシュ値の先頭にランダムな文字列を追加して保存する処理を作成して下さい。

secretから導出されるハッシュ値の例）
	
	7c34af36238d611ba906c7ee9096809249b3bda682    # 先頭2文字がランダムに選ばれたsalt
	16286ccb5040e07af9d7fa477964d7de83526579c6
	0eea2be13a604f498aad339381869cce7158ba7844
	e8b72d57786c5cf2258113e321c01824ee2a6b8207
	c957d54086041df863552614d581d71edeb1dd7723
	a3ea1bff2e1871c676c90aaa6244b046796ab8f701
	…

例えば、例の１番目は、7cがsaltであり、その後 7csecret のハッシュ値が続いています。ユーザーはパスフレーズとして、"secret"だけを覚えておきます。

saltを加えハッシュ値をスクランブルする方法は、パスワードが漏洩した際、辞書による解読を多少困難にする程度の効力しかなく、あくまで補助的なセキュリティ対策です。

###subroutine

	Vol02::shash
	Vol02::shashCheck



###条件

* SHA1によるハッシュを求めるには、Digest::SHA1等の外部モジュールを用いてもよい。

#### shash

* 生成方法
	* ランダムな文字(例えば1f)、saltを選びます。
	* 元のワード(例えばsecret)の先頭にsaltを追加します。 => 1fsecret
	* 1fsecretからハッシュ値を生成します。 => hashed-1fsecret
	* 生成されたハッシュの先頭にsaltを加えます。 => 1f hashed-1fsecret

* 引数: ハッシュ値の元となる文字列。
* 戻り値: ランダムな16進数2文字に続き、SHA1アルゴリズムによるハッシュ値を含む文字列を戻す。引数が指定されなかったときは0を返す。使用されるaからfの文字は全て小文字とする。

#### shashCheck

* 確認方法 (shashCheckにて実装）
	* salt部とハッシュ部を分離します。 1f / hashed-1fsecret
	* 確認対象文字列とsaltを連結し、ハッシュを得ます。 1f + challenged => hashed-1fchallenged
	* hashed-1fchallenged と hashed-1fsecret が一致すれば、確認対象文字列が正当であることが確認できます。

* 引数
	* 第一引数: ハッシュのもとになった文字列。
	* 第二引数: shashで求められた文字列。大文字小文字は区別される。
	
* 戻り値: 確認に成功した場合は1を返す。失敗したとき、または２つの引数が指定されていないときは0を返す。


###test program

	t/saltedHash.t

###想定工数
30行程度 / 45分







[Q205] ハッシュ・リファレンス操作
------------------
[総務省、統計局が公開している](http://www.e-stat.go.jp/) 2010年の国勢調査結果がCSV(Comma Sparated Value)形式のファイルで保管されています。(data/japan-2011-population.csv 文字コードはCP932からUTF-8に変換済)

data/japan-2011-population.csv　ヘッダーと北海道に関する行）

	10,"※大項目","地域コード","地域識別コード","境域年次(2010)","境域年次(2000)","","人口　平成22年　(a)","人口　平成17年（組替） 2)","平成17年〜22年の人口増減数 2)","平成17年〜22年の人口増減率（％） 2)","面積（km2）　(b) 1)2)","人>口密度（1km2当たり）　(a)/(b) 2)"
	
	...
	
	14,"","01000","a","2010","2000","北海道",5506419,5627737,-121318,-2.1557155212,83456.87,70.2
	…
	

このファイルをもとに、地域コードを入力すると、地域名、平成22年度(2010)の人口、平成17年度(2005)の人口、面積を含むデータを、次のような構造のハッシュ・リファレンスを返す処理を作成して下さい。

データ構造)

	ハッシュ・リファレンス = {
	
        'code' => '01000'			  # 地域コード (2)
        'name' => '北海道',			  # 地域名    (6)
        'population' => [			  # 人口      
                          '5506419', # 2010年   (7)
                          '5627737'  # 2005年   (8)
                        ],
        'area' => '83456.87',        # 面積      (9)
        
    };

()内は、CSVファイル内のフィールド番号を示す。

###routine

	Vol02::fetchPrefecture
	
###条件
* 引数:
	* 第一引数：地域コード
	* 第二引数：対象データファイル。デフォルトは"data/japan-2011-population.csv"。
	
* 戻り値:
	* 指定された地域コードを持つレコードを探し、上記、code, name, population(2010年と2005年の配列を含む), areaを含むハッシュのリファレンスを返す。
	* 第４フィールドに"2010"というデータが入っていない行は対象外とする。
	* ファイル内に同一地域コードを持つ行が複数存在した場合は、最初に発見された行のデータを返す。
	* 地域コードが指定されなかった場合や、指定された地域コードがファイル内に存在しなかった場合は0を返す。
	* データ・ファイルのオープンに失敗したときは -9 を返す。

*文字コードについて：
	* データ・ファイルはUTF8、及び改行をLFとして提供されているが、環境に合わせ変換したものを使用してもよい。
	
###想定工数
30行程度 / 45分






--



